<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<title>Dramify Player</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<style>
html,body{
  margin:0;
  padding:0;
  width:100%;
  height:100%;
  background:#000;
  overflow:hidden;
  font-family:system-ui,-apple-system,sans-serif;
}

#container{
  position:relative;
  width:100%;
  height:100%;
  background:#000;
}

video{
  width:100%;
  height:100%;
  object-fit:contain;
  background:#000;
}

/* overlay */
#overlay{
  position:absolute;
  inset:0;
  display:flex;
  align-items:center;
  justify-content:center;
  background:rgba(0,0,0,.45);
  color:#fff;
  font-size:22px;
  z-index:10;
  cursor:pointer;
}
#overlay.hidden{display:none}

/* ===== CONTROLES ===== */
#controls{
  position:absolute;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
  z-index:20;
  display:flex;
  gap:18px;
  opacity:0;
  pointer-events:none;
  transition:opacity .25s ease;
}

#controls.show{
  opacity:1;
  pointer-events:auto;
}

/* botones */
.btn{
  width:64px;
  height:64px;
  border-radius:50%;
  border:none;
  background:rgba(20,20,20,.65);
  color:#fff;
  font-size:24px;
  display:flex;
  align-items:center;
  justify-content:center;
  backdrop-filter:blur(8px);
  cursor:pointer;
  transition:transform .15s ease;
}
.btn:active{
  transform:scale(.92);
}

/* ===== ADAPTACIÓN POR ORIENTACIÓN ===== */
body.portrait #controls{
  flex-direction:column;
}

body.landscape #controls{
  flex-direction:row;
}
</style>
</head>

<body class="portrait">
<div id="container">

  <div id="controls">
    <button class="btn" id="closeBtn">✕</button>
    <button class="btn" id="playBtn">▶︎</button>
    <button class="btn" id="rotateBtn">⟳</button>
  </div>

  <div id="overlay">▶︎ Tocar para reproducir</div>

  <video
    id="player"
    controls
    playsinline
    webkit-playsinline
    preload="metadata">
  </video>

</div>

<script>
const video = document.getElementById('player');
const overlay = document.getElementById('overlay');
const controls = document.getElementById('controls');
const playBtn = document.getElementById('playBtn');
const rotateBtn = document.getElementById('rotateBtn');
const closeBtn = document.getElementById('closeBtn');

let hideTimer;
let locked = false;

/* ===== ORIENTACIÓN REAL ===== */
function updateOrientation(){
  if(window.matchMedia('(orientation: portrait)').matches){
    document.body.classList.add('portrait');
    document.body.classList.remove('landscape');
  }else{
    document.body.classList.add('landscape');
    document.body.classList.remove('portrait');
  }
}
updateOrientation();
window.addEventListener('orientationchange', updateOrientation);
window.addEventListener('resize', updateOrientation);

/* ===== CARGAR VIDEO ===== */
const params = new URLSearchParams(location.search);
let url = params.get('video');
if(url){
  try{ url = decodeURIComponent(url); }catch(e){}
  video.src = url;
}else{
  overlay.textContent = '❌ No se recibió video';
}

/* ===== CONTROLES ===== */
function showControls(){
  controls.classList.add('show');
  clearTimeout(hideTimer);
  hideTimer = setTimeout(()=>{
    controls.classList.remove('show');
  },2000);
}

/* play */
function play(){
  video.play()
    .then(()=>overlay.classList.add('hidden'))
    .catch(()=>overlay.textContent='❌ Error');
}
overlay.onclick = play;
playBtn.onclick = play;
video.onplay = ()=>showControls();

/* rotar pantalla */
rotateBtn.onclick = async ()=>{
  if(!screen.orientation?.lock) return;
  try{
    if(!locked){
      await screen.orientation.lock('landscape');
      locked = true;
    }else{
      await screen.orientation.unlock();
      locked = false;
    }
  }catch(e){}
  showControls();
};

/* cerrar */
closeBtn.onclick = ()=>{
  try{ screen.orientation.unlock(); }catch(e){}
  if(window.Capacitor?.Plugins?.App){
    window.Capacitor.Plugins.App.exitApp();
  }else{
    history.back();
  }
};

/* mostrar controles al tocar */
['touchstart','click'].forEach(evt=>{
  document.addEventListener(evt, showControls, { passive:true });
});
</script>
</body>
</html>
